{"version":3,"file":"_server.ts-D6ejMjTK.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/proxy/_...path_/_server.ts.js"],"sourcesContent":["import { g as getConnections } from \"../../../../../chunks/connections.js\";\nconst HOP_BY_HOP_HEADERS = /* @__PURE__ */ new Set([\n  \"connection\",\n  \"keep-alive\",\n  \"proxy-authenticate\",\n  \"proxy-authorization\",\n  \"te\",\n  \"trailers\",\n  \"transfer-encoding\",\n  \"upgrade\"\n]);\nasync function forward(event) {\n  const { path = \"\" } = event.params;\n  const { base_url: rawBaseUrl, api_key: apiKey } = getConnections();\n  if (!rawBaseUrl) {\n    return new Response(\"Missing LM Studio base URL configuration\", { status: 500 });\n  }\n  const baseUrl = rawBaseUrl.replace(/\\/+$/, \"\");\n  const suffix = path ? `/${path}` : \"\";\n  const targetUrl = `${baseUrl}${suffix}${event.url.search}`;\n  const method = event.request.method.toUpperCase();\n  const headers = new Headers();\n  event.request.headers.forEach((value, key) => {\n    const lower = key.toLowerCase();\n    if (HOP_BY_HOP_HEADERS.has(lower) || lower === \"host\" || lower === \"content-length\") {\n      return;\n    }\n    headers.set(key, value);\n  });\n  if (apiKey && !headers.has(\"authorization\")) {\n    headers.set(\"authorization\", `Bearer ${apiKey}`);\n  }\n  let body;\n  if (method !== \"GET\" && method !== \"HEAD\") {\n    const arrayBuffer = await event.request.arrayBuffer();\n    body = arrayBuffer;\n  }\n  const init = {\n    method,\n    headers,\n    body\n  };\n  try {\n    const response = await fetch(targetUrl, init);\n    const outgoingHeaders = new Headers();\n    response.headers.forEach((value, key) => {\n      const lower = key.toLowerCase();\n      if (HOP_BY_HOP_HEADERS.has(lower)) {\n        return;\n      }\n      outgoingHeaders.set(key, value);\n    });\n    return new Response(response.body, {\n      status: response.status,\n      statusText: response.statusText,\n      headers: outgoingHeaders\n    });\n  } catch (error) {\n    console.error(\"Proxy request failed\", error);\n    return new Response(\"Failed to reach LM Studio API\", { status: 502 });\n  }\n}\nconst GET = async (event) => forward(event);\nconst POST = async (event) => forward(event);\nconst PUT = async (event) => forward(event);\nconst PATCH = async (event) => forward(event);\nconst DELETE = async (event) => forward(event);\nexport {\n  DELETE,\n  GET,\n  PATCH,\n  POST,\n  PUT\n};\n"],"names":[],"mappings":"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"}